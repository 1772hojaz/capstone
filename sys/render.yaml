# Render service definitions for this repository.
#
# Instructions:
# 1) Do NOT commit secrets into this file. Instead set the secret values in the
#    Render dashboard after you create the services (or use the `render` CLI with
#    `--env`/secrets). The placeholders below are for documentation only.
# 2) Connect this GitHub repository to Render and deploy using this file (Render
#    will create the services declared below).

services:
  - type: web
    name: groupbuy-backend
    env: python
    region: oregon
    plan: starter
  buildCommand: pip install -r backend/requirements-prod.txt
    startCommand: uvicorn backend.main:app --host 0.0.0.0 --port $PORT
    workingDirectory: backend
    # Do not store secrets here. Add them in the Render dashboard after service is created.
    envVars:
      - key: SECRET_KEY
        value: "REPLACE_WITH_SECRET"
      - key: FLUTTERWAVE_SECRET_KEY
        value: "REPLACE_WITH_FLW_SECRET"
      - key: FLUTTERWAVE_PUBLIC_KEY
        value: "REPLACE_WITH_FLW_PUBLIC"
      - key: FLUTTERWAVE_ENCRYPTION_KEY
        value: "REPLACE_WITH_FLW_ENCRYPTION"
      - key: DATABASE_URL
        # This will be populated automatically when an attached database is created (see databases: below)
        value: "${DATABASE_URL}"

  - type: static
    name: groupbuy-frontend
    env: static
    region: oregon
    plan: starter
    # Render builds the site from the repo root. The buildCommand below builds the Vite app.
    buildCommand: cd Front-end/connectsphere && npm ci && npm run build
    # Publish directory is the Vite `dist` output for the connectsphere app
    publish: Front-end/connectsphere/dist

databases:
  - name: groupbuy-db
    engine: postgresql
    version: "15"
    plan: starter

# Notes / recommended manual steps on Render dashboard after deployment
# - In the backend service's Environment tab set sensible, secret values for:
#     SECRET_KEY, FLUTTERWAVE_SECRET_KEY, FLUTTERWAVE_PUBLIC_KEY,
#     FLUTTERWAVE_ENCRYPTION_KEY
# - Render will create a DATABASE_URL for the `groupbuy-db` database; ensure
#   the backend service has the DATABASE_URL environment variable set (Render
#   usually wires it automatically when you create the database in the same
#   Render Blueprint).
# - If you have file storage (uploads) that rely on Cloudinary, set the
#   CLOUDINARY_CLOUD_NAME, CLOUDINARY_API_KEY, CLOUDINARY_API_SECRET env vars.
# - If you want to use Redis or Celery, create a Redis instance on Render and
#   add REDIS_URL to backend env vars.
